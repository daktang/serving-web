<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="theme-color" content="#000000" />
  <link rel="icon" type="image/png" id="fevicon" href="images/icons/favicon.png" sizes="32x32">

  <!-- ⚠️ 최우선: 어떤 스크립트보다 먼저 fetch/XHR를 갈아끼움 -->
  <script>
  (function () {
    var HOST_RE = /https?:\/\/portal\.aiserving\.dev\.aip\.domain\.net\/(?:net\/)?(?=(api|coreproxy|ext-dit\/api|models|serving|authservice)\/)/i;

    function hardRewrite(str) {
      if (typeof str !== 'string') return str;
      // 절대 URL → 상대경로 (/api..., /coreproxy..., /ext-dit/api..., /models..., /serving..., /authservice...)
      var out = str.replace(HOST_RE, '/');
      if (out !== str) return out;

      // 혹시 문자열에 호스트가 포함만 되어 있는 경우도 강제 치환
      var i = str.indexOf('portal.aiserving.dev.aip.domain.net/');
      if (i >= 0) {
        var tail = str.slice(i + 'portal.aiserving.dev.aip.domain.net/'.length);
        // net/ 가 끼어든 경우 제거
        if (tail.indexOf('net/') === 0) tail = tail.slice(4);
        if (/^(api|coreproxy|ext-dit\/api|models|serving|authservice)\//i.test(tail)) {
          return '/' + tail;
        }
      }
      return str;
    }

    // fetch 패치 (덮어쓰기 방지)
    var _origFetch = window.fetch;
    function patchedFetch(input, init) {
      if (typeof input === 'string') {
        input = hardRewrite(input);
      } else if (input && input.url) {
        var nu = hardRewrite(input.url);
        if (nu !== input.url) input = new Request(nu, input);
      }
      init = init || {};
      if (init.credentials == null) init.credentials = 'include';
      return _origFetch.call(this, input, init);
    }
    if (_origFetch) {
      Object.defineProperty(window, 'fetch', { value: patchedFetch, writable: false, configurable: false });
    }

    // XMLHttpRequest 패치 (덮어쓰기 방지)
    var _XHR = window.XMLHttpRequest;
    if (_XHR) {
      var _open = _XHR.prototype.open;
      _XHR.prototype.open = function (method, url) {
        try { url = hardRewrite(url); } catch (_) {}
        return _open.apply(this, [method, url]);
      };
      var _send = _XHR.prototype.send;
      _XHR.prototype.send = function (body) {
        try { if (this.withCredentials == null) this.withCredentials = true; } catch (_){}
        return _send.apply(this, arguments);
      };
      // XHR 자체를 못 바꾸게 잠급니다(다시 덮어쓰기 방지)
      try { Object.freeze(_XHR.prototype); } catch(_){}
    }

    // jQuery 1.x ajax 패치 (있을 경우)
    var _defineJqHook = function () {
      if (!window.jQuery || !jQuery.ajax) return;
      var _ajax = jQuery.ajax;
      jQuery.ajax = function (opt) {
        if (typeof opt === 'string') opt = { url: opt };
        opt = opt || {};
        if (opt.url) opt.url = hardRewrite(opt.url);
        opt.xhrFields = opt.xhrFields || {};
        if (opt.xhrFields.withCredentials == null) opt.xhrFields.withCredentials = true;
        return _ajax.call(jQuery, opt);
      };
      try { Object.defineProperty(jQuery, 'ajax', { writable: false }); } catch(_){}
    };
    document.addEventListener('DOMContentLoaded', _defineJqHook);

    // axios 요청 인터셉터 (있을 경우)
    function hookAxios() {
      if (!window.axios || !window.axios.interceptors || !window.axios.interceptors.request) return;
      window.axios.interceptors.request.use(function (config) {
        if (config && config.url) {
          var nu = hardRewrite(config.url);
          if (nu !== config.url) config.url = nu;
        }
        if (!config.withCredentials) config.withCredentials = true;
        return config;
      });
    }
    // 번들 로드 전/후 모두 시도
    hookAxios();
    window.addEventListener('load', hookAxios);
  })();
  </script>

  <!-- 기존 순서 유지 -->
  <script src="config.js"></script>
  <script src="//code.jquery.com/jquery-1.4.2.min.js"></script>
  <script src="//cdn.socket.io/4.4.1/socket.io.min.js"></script>

  <script>document.title = window.config.applicationTitle || window.config.applicationName;</script>
</head>
<body>
  <noscript>You need to enable JavaScript to run this app.</noscript>
  <div id="root" class="grip-resizable"></div>
</body>
</html>
