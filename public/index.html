<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="theme-color" content="#000000" />
  <link rel="icon" type="image/png" id="fevicon" href="images/icons/favicon.png" sizes="32x32">

  <!-- ⚠️ 어떤 스크립트보다 먼저: portal로 향하는 절대URL을 전부 / 로 강제 -->
  <script>
  (function () {
    // https://portal.../(net/)?<prefix> → /<prefix>
    var RE = /^https?:\/\/portal\.aiserving\.dev\.aip\.domain\.net\/(?:net\/)?(?=(api|coreproxy|ext-dit\/api|models|serving|authservice)\/)/i;
    function toLocal(u){
      if (typeof u !== 'string') return u;
      var v = u.replace(RE, '/');                      // 정상 케이스
      if (v !== u) return v;
      var i = u.indexOf('portal.aiserving.dev.aip.domain/net/'); // 오탈자 케이스
      if (i >= 0) {
        var tail = u.slice(i + 'portal.aiserving.dev.aip.domain/'.length);
        if (tail.indexOf('net/') === 0) tail = tail.slice(4);
        if (/^(api|coreproxy|ext-dit\/api|models|serving|authservice)\//i.test(tail)) return '/' + tail;
      }
      return u;
    }

    // fetch 강제
    var _f = window.fetch;
    if (_f) {
      Object.defineProperty(window, 'fetch', { configurable:false, writable:false, value: function(input, init){
        if (typeof input === 'string') input = toLocal(input);
        else if (input && input.url)   input = new Request(toLocal(input.url), input);
        init = init || {};
        if (init.credentials == null) init.credentials = 'include';
        return _f.call(this, input, init);
      }});
    }

    // XHR 강제 (axios 포함)
    var X = window.XMLHttpRequest;
    if (X) {
      var _open = X.prototype.open, _send = X.prototype.send;
      X.prototype.open = function(method, url){ return _open.call(this, method, toLocal(url)); };
      X.prototype.send = function(body){ try{ if (this.withCredentials == null) this.withCredentials = true; }catch(e){} return _send.apply(this, arguments); };
    }

    // jQuery 1.x 강제
    var hookJq = function(){
      if (!window.jQuery || !jQuery.ajax) return;
      var _ajax = jQuery.ajax;
      jQuery.ajax = function(opt){
        if (typeof opt === 'string') opt = { url: opt };
        opt = opt || {};
        if (opt.url) opt.url = toLocal(opt.url);
        opt.xhrFields = opt.xhrFields || {};
        if (opt.xhrFields.withCredentials == null) opt.xhrFields.withCredentials = true;
        return _ajax.call(jQuery, opt);
      };
    };
    // 즉시/로드 후 모두 시도
    hookJq(); window.addEventListener('load', hookJq);
  })();
  </script>

  <!-- 기존 순서 유지 -->
  <script src="config.js"></script>
  <script src="//code.jquery.com/jquery-1.4.2.min.js"></script>
  <script src="//cdn.socket.io/4.4.1/socket.io.min.js"></script>

  <script>document.title = window.config.applicationTitle || window.config.applicationName;</script>
</head>
<body>
  <noscript>You need to enable JavaScript to run this app.</noscript>
  <div id="root" class="grip-resizable"></div>
</body>
</html>
